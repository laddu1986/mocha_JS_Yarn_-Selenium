#TODO yarn-lock  -frozen lock file --production
#TODO copy only tests
# FROM node:8.10.0-slim AS build-deps
FROM node:10-alpine AS build-deps

RUN apk add python make g++
# RUN apk add --update curl

RUN apk update
RUN apk fetch openjdk8
RUN apk add openjdk8

# Set environment
ENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdk/jre
ENV PATH ${PATH}:${JAVA_HOME}/bin
ENV NODE_ENV production
# RUN apk update
# RUN apk fetch openjdk8
# RUN apk add openjdk8

COPY package.json /tmp/package.json
RUN cd /tmp && yarn install --prod --frozen-lockfile
# yarn run prod
RUN mkdir -p /qa && cp -a /tmp/node_modules /qa/
RUN npm install -g allure-commandline 

WORKDIR /qa
COPY . /qa